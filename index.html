<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Yota’s Light Controller</title>
<style>
  :root{
	--bg:#0f172a;          /* slate-900 */
	--panel:#111827;       /* gray-900 */
	--card:#1f2937;        /* gray-800 */
	--muted:#374151;       /* gray-700 */
	--text:#e5e7eb;        /* gray-200 */
	--accent:#60a5fa;      /* blue-400 */
	--ok:#22c55e;          /* green-500 */
	--warn:#ef4444;        /* red-500 */
	--shadow: 0 10px 20px rgba(0,0,0,.35);
	--radius:18px;
  }
  html,body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;}
  .app{max-width:720px;margin:0 auto;padding:14px 16px 40px;}
  header{
	position:sticky;top:0;z-index:2;
	background:linear-gradient(180deg,#0b3b9c 0%, #0a3290 100%);
	color:white;border-bottom:1px solid rgba(255,255,255,.15);
	padding:18px 16px;border-radius:0 0 16px 16px;box-shadow:var(--shadow);
  }
  header h1{margin:0;font-size:20px;font-weight:700;letter-spacing:.2px}
  .status{
	display:flex;align-items:center;gap:10px;margin-top:10px;
	font-size:14px;
  }
  .pill{padding:6px 10px;border-radius:999px;background:var(--muted);font-weight:600}
  .pill.ok{background:var(--ok);color:#06210f}
  .pill.err{background:var(--warn)}
  .connect{
	margin-left:auto;background:white;color:#0a1930;border:none;border-radius:999px;
	padding:8px 14px;font-weight:700;box-shadow:var(--shadow);cursor:pointer
  }
  h2{
	margin:18px 4px 10px;font-size:18px;font-weight:800;
	color:#fff;border-left:4px solid var(--accent);padding-left:8px
  }
  .grid{
	display:grid;gap:12px;margin:10px 0 22px;
	grid-template-columns:repeat(2,1fr);
  }
  .grid.triple{grid-template-columns:repeat(3,1fr);}
  .btn{
	appearance:none;-webkit-appearance:none;
	width:100%;padding:16px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.08);
	background:var(--card);color:var(--text);font-weight:800;font-size:16px;
	box-shadow:var(--shadow);cursor:pointer;transition:transform .04s ease, background .2s ease, border-color .2s ease;
  }
  .btn:active{transform:scale(.98)}
  .btn.on{background:linear-gradient(180deg,#20d26d,#15b158);color:#061b10;border-color:rgba(0,0,0,.1)}
  .btn.strobe.on{background:linear-gradient(180deg,#fde047,#facc15);color:#3b2f00}
  .btn.full{grid-column:1/-1}
  .note{opacity:.7;font-size:12px;margin:6px 4px 0}
  .footer-space{height:40px}
</style>
</head>
<body>
  <div class="app">
	<header>
	  <h1>Yota’s Light Controller</h1>
	  <div class="status">
		<span id="connPill" class="pill err">Not Connected</span>
		<span id="deviceName" class="note"></span>
		<button id="btnConnect" class="connect">Connect</button>
	  </div>
	</header>

	<h2>Strobes</h2>
	<div class="grid">
	  <button class="btn strobe" data-cmd="STROBE_EMERGENCY" id="Btn_Strobe_Emergency">Emergency</button>
	  <button class="btn strobe" data-cmd="STROBE_PARTY" id="Btn_Strobe_Party">Party Mode</button>
	  <button class="btn strobe" data-cmd="STROBE_SOS" id="Btn_Strobe_SOS">SOS</button>
	  <button class="btn strobe" data-cmd="STROBE_FLASHY" id="Btn_Strobe_Flashy">Flashy Flashy</button>
	  <button class="btn strobe full" data-cmd="STOPSTROBE">Stop Strobe</button>
	</div>

	<h2>Light Switches</h2>
	<div class="grid">
	  <button class="btn toggle" data-on="FRONTWHITEON" data-off="FRONTWHITEOFF" id="Btn_FrontWhite">Front Flood W</button>
	  <button class="btn toggle" data-on="FRONTAMBERON" data-off="FRONTAMBEROFF" id="Btn_FrontAmber">Front Flood A</button>

	  <button class="btn toggle" data-on="RACKFRONTWHITEON" data-off="RACKFRONTWHITEOFF" id="Btn_RackFrontWhite">RackLight F/W</button>
	  <button class="btn toggle" data-on="RACKFRONTAMBERON" data-off="RACKFRONTAMBEROFF" id="Btn_RackFrontAmber">RackLight F/A</button>

	  <button class="btn toggle" data-on="RACKLEFTON" data-off="RACKLEFTOFF" id="Btn_RackLeft">RackLight L/Side</button>
	  <button class="btn toggle" data-on="RACKRIGHTON" data-off="RACKRIGHTOFF" id="Btn_RackRight">RackLight R/Side</button>

	  <button class="btn toggle" data-on="RACKBACKON" data-off="RACKBACKOFF" id="Btn_RackBack">RackLight Back</button>
	  <button class="btn" data-cmd="ALLLIGHTS" id="Btn_AllLights">All Lights</button>
	</div>

	<h2>Individual Switches</h2>
	<div class="grid triple">
	  <button class="btn relay" data-relay="1"  id="Btn_R1">Front Flood L/W</button>
	  <button class="btn relay" data-relay="2"  id="Btn_R2">Front Flood L/A</button>
	  <button class="btn relay" data-relay="3"  id="Btn_R3">Front Flood R/A</button>

	  <button class="btn relay" data-relay="4"  id="Btn_R4">Front Flood R/W</button>
	  <button class="btn relay" data-relay="5"  id="Btn_R5">RackLight F/W/L</button>
	  <button class="btn relay" data-relay="6"  id="Btn_R6">RackLight F/A/L</button>

	  <button class="btn relay" data-relay="7"  id="Btn_R7">RackLight F/A/R</button>
	  <button class="btn relay" data-relay="8"  id="Btn_R8">RackLight F/W/R</button>
	  <button class="btn relay" data-relay="9"  id="Btn_R9">RackLight L/F</button>

	  <button class="btn relay" data-relay="10" id="Btn_R10">RackLight L/B</button>
	  <button class="btn relay" data-relay="11" id="Btn_R11">RackLight R/F</button>
	  <button class="btn relay" data-relay="12" id="Btn_R12">RackLight R/B</button>

	  <button class="btn relay" data-relay="13" id="Btn_R13">RackLight B/L</button>
	  <button class="btn relay" data-relay="14" id="Btn_R14">RackLight B/R</button>
	</div>

	<div class="footer-space"></div>
  </div>

<script>
/** ===== BLE CONFIG ===== */
const SERVICE_UUID = "19B10000-E8F2-537E-4F6C-D104768A1214";
const CHAR_UUID    = "19B10001-E8F2-537E-4F6C-D104768A1214";

let device, server, service, characteristic;
const enc = new TextEncoder();

/** ===== UI HELPERS ===== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
function setConn(status, name="") {
  const pill = $("#connPill");
  const dn = $("#deviceName");
  if(status){
	pill.textContent = "Connected";
	pill.classList.remove("err"); pill.classList.add("ok");
	dn.textContent = name ? `• ${name}` : "";
  }else{
	pill.textContent = "Not Connected";
	pill.classList.remove("ok"); pill.classList.add("err");
	dn.textContent = "";
	// on disconnect, clear UI states so nothing looks stuck on
	$$(".btn.on").forEach(b=>b.classList.remove("on"));
  }
}

/** ===== CORE BLE ===== */
async function connect() {
  try{
	device = await navigator.bluetooth.requestDevice({
	  filters: [{services:[SERVICE_UUID]}]
	});
	device.addEventListener('gattserverdisconnected', ()=>setConn(false));
	server = await device.gatt.connect();
	service = await server.getPrimaryService(SERVICE_UUID);
	characteristic = await service.getCharacteristic(CHAR_UUID);
	setConn(true, device.name || device.id || "Controller");
  }catch(err){
	console.error(err);
	alert("Bluetooth connect failed.\n" + err.message);
  }
}

async function send(cmd){
  if(!characteristic){
	await connect();
	if(!characteristic) return;
  }
  try{
	await characteristic.writeValue(enc.encode(cmd));
  }catch(err){
	console.error(err);
	alert("Send failed: " + err.message);
	setConn(false);
  }
}

/** ===== BUTTON WIRING ===== */
// Strobes (toggle on same command, special STOP button)
$$(".btn.strobe").forEach(btn=>{
  btn.addEventListener("click", async ()=>{
	const cmd = btn.dataset.cmd;
	await send(cmd);
	// visual state: highlight the four strobe buttons if not STOP
	if(cmd === "STOPSTROBE"){
	  $$(".btn.strobe").forEach(b=>b.classList.remove("on"));
	}else{
	  $$(".btn.strobe").forEach(b=>b.classList.remove("on"));
	  btn.classList.add("on");
	}
  });
});

// Main toggle groups (with ON/OFF)
$$(".btn.toggle").forEach(btn=>{
  btn.addEventListener("click", async ()=>{
	const turningOn = !btn.classList.contains("on");
	const cmd = turningOn ? btn.dataset.on : btn.dataset.off;
	await send(cmd);
	btn.classList.toggle("on", turningOn);
  });
});

// Individual relays RnON/RnOFF
$$(".btn.relay").forEach(btn=>{
  btn.addEventListener("click", async ()=>{
	const n = btn.dataset.relay;
	const turningOn = !btn.classList.contains("on");
	const cmd = turningOn ? `R${n}ON` : `R${n}OFF`;
	await send(cmd);
	btn.classList.toggle("on", turningOn);
  });
});

// Connect button
$("#btnConnect").addEventListener("click", connect);

// Feature checks / helpful messages
if(!('bluetooth' in navigator)){
  alert("Web Bluetooth not supported on this browser. Use iOS 16.4+ Safari or Chrome on Android.");
}
</script>
</body>
</html>
